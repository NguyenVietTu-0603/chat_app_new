{% extends "includes/layouts/a.html" %}
{% block content %}
{% load static %}
<h2>Kết quả tìm kiếm: "{{ query }}"</h2>

{% if users %}
    <ul>
        {% for user in users %}
            <li>
                <div>
                    <img src="{{ user.profile.avatar }}" alt="{{ user.username }}" width="50" height="50">
                    <h3>{{ user.profile.name }}</h3>
                    <p>
                        @{{ user.username }}
                        {% if user.profile.location %}
                            - {{ user.profile.location }}
                        {% endif %}
                    </p>
                </div>
                
                <div>
                    <a href="{% url 'user_profile' user.id %}">Xem hồ sơ</a>
                    
                    {% if user.id in friend_ids %}
                        <!-- Đã là bạn bè -->
                        <span>Bạn bè</span>
                    {% elif user.id in pending_requests %}
                        <!-- Có lời mời kết bạn từ người này -->
                        <a href="{% url 'accept_friend_request' user.id %}">Chấp nhận</a>
                        <a href="{% url 'decline_friend_request' user.id %}">Từ chối</a>
                    {% elif user.id in sent_requests %}
                        <!-- Đã gửi lời mời kết bạn cho người này -->
                        <a href="{% url 'cancel_friend_request' user.id %}">Đã gửi lời mời</a>
                    {% elif user.id in blocked %}
                        <!-- Đã chặn người này -->
                        <a href="{% url 'unblock_user' user.id %}">Đã chặn</a>
                    {% else %}
                        <!-- Chưa có mối quan hệ -->
                        <a href="{% url 'send_friend_request' user.id %}">Kết bạn</a>
                    {% endif %}
                </div>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>Không tìm thấy người dùng nào phù hợp với từ khóa "{{ query }}".</p>
{% endif %}
{% endblock content %}